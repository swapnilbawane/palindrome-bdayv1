let inputDate = document.querySelector("#input-date");
let btnShow = document.querySelector("#btn-show");
let outputMessage = document.querySelector("#output-message");

function createDifferentDateFormats(yyyy, mm, dd) {
  var yyyymmdd = yyyy + mm + dd;
  var mmddyyyy = mm + dd + yyyy;
  var ddmmyyyy = dd + mm + yyyy;
  var ddmmyy = dd + mm + yyyy.slice(-2);
  var mmddyy = mm + dd + yyyy.slice(-2);
  var yyddmm = yyyy.slice(-2) + dd + mm;

  return [yyyymmdd, mmddyyyy, ddmmyyyy, ddmmyy, mmddyy, yyddmm];
}

function reverseString(takeString) {
  let reversedString = "";

  for (let i = takeString.length; i >= 0; i--) {
    reversedString = reversedString + takeString.charAt(i);
  }

  return reversedString;
}

function checkPalindromeForAllDates(diffDateFormatsArray) {
  let list = [];

  for (let i = 0; i < diffDateFormatsArray.length; i++) {
    if (reverseString(diffDateFormatsArray[i]) === diffDateFormatsArray[i])
      list[i] = 1;
    else list[i] = 0;
  }

  return list;
}

function leapYear(yearNum) {
  if (yearNum % 400 === 0) {
    return 1;
  }

  if (yearNum % 100 === 0) {
    return 1;
  }

  if (yearNum % 4 === 0) {
    return 1;
  } else return 0;
}


function prevDate ( yyyy, mm, dd ) 
{ // function prevDate starts 
var day = dd;
var month = mm;
var year = yyyy; 

day = day-1; 

let monthsinYear = [1,2,3,4,5,6,7,8,9,10,11,12];
let daysinMonth = [31,28,31,30,31,30,31,31,30,31,30,31];

if ( month === 3 )
{ 
    if (day === 0 )
    {
        if(leapYear(year)) 
        {
            day = 29;
            month = 2; 
        } // check if leap year 
        else 
        {
         day = 28;
         month = 2; 
        } // non leap year 

    } // move to february if day = 0 

} //if loop ends for month = 3 

else // other than 3rd month 
if ( day === 0  ) 
{ 
            if ( month === 2 || month === 4 || month === 6 || month === 9 || month === 11 )
                { 
                     day = 31; 
                    month--;
                } // moving to 31 days month 

            else 
                { 

                    if ( month === 8 )
 
                        {
                            day = 31;
                            month--; 
                        } // month = 8 

                    else 
                        {
                            day = 30;
                            month--; 
                        } // month is 

                } 
} // day = 0 

if ( month === 0 )
{ 
 day = 31;
 month = 12; 
 year--;    
}

return [ year, month, day ]; 

} // function prevDate ends 

function previousPalindromeDateCalc ( yyyy, mm, dd, isPalindrome ) 
{ 
    var day = Number(dd);
    var month = Number(mm);
    var year = Number(yyyy);
    let counterCalc = 0; 
    let returnDate; 

    // for each date recieved, calculate next date, calculate if its palindrome for all formats, check if any palindrome in results lists, break loop and return counter value and date 

do 
    {                
        // do start 
        // converted to string to calculate prev date, function demands number type.
        
        var prevDateMade = prevDate ( year, month, day ); // returns an array of numbers 
        counterCalc++;

        // turn into standard format 

                var pYear = prevDateMade[0].toString();

                if ( pMonth < 10 )
                var pMonth = "0"+prevDateMade[1];
                else 
                var pMonth = prevDateMade[1].toString();

                if ( pDay < 10 )
                var pDay = "0"+prevDateMade[2]; 
                else 
                var pDay = prevDateMade[2].toString(); 

        // turn it into a string to calculate formats 
        var diffDateFormatsArray = createDifferentDateFormats(pYear, pMonth, pDay);

        // send array of different formats into palindrome function. 
        var checkResultsForDates = checkPalindromeForAllDates(diffDateFormatsArray);

        
        // received list which has palindrome or not values; navigating through it.
        for  ( let i = 0; i<checkResultsForDates.length; i++)
            { 
                if(checkResultsForDates[i])
                { isPalindrome = 1; returnDate = prevDateMade; }
                else 
                { isPalindrome = 0; }

                if(isPalindrome) break; 
            }


         year = prevDateMade[0];
         month = prevDateMade[1];
         day = prevDateMade[2];   

} while(!isPalindrome); 

return [ counterCalc, returnDate]; 

}

function calcPalindrome(e) {
  var bDay = inputDate.value;
  let isPalindrome = 0;

  if (bDay !== "") {
    // which means it is not empty field
    var bDayArray = bDay.split("-");

    var yyyy = bDayArray[0];

    if (bDayArray[1] < 10) {
      var mm = "0" + Number(bDayArray[1]);
    } else var mm = bDayArray[1];

    if (bDayArray[2] < 10) {
      var dd = "0" + Number(bDayArray[2]);
    } else var dd = bDayArray[2];

    console.log(dd, mm, yyyy);

    // create different date formats
    var diffDateFormatsArray = createDifferentDateFormats(yyyy, mm, dd);
    console.log(diffDateFormatsArray);
    var checkResultsForDates = checkPalindromeForAllDates(diffDateFormatsArray);
    console.log("Palindrome array list:" + checkResultsForDates);

    for (let i = 0; i < checkResultsForDates.length; i++) {
      if (checkResultsForDates[i]) {
        isPalindrome = 1;
        break;
      } else {
        isPalindrome = 0;
      }
    }

    if (isPalindrome) {
      outputMessage.innerText = "Yay. It is palindrome.";
    } else {
      console.log("year", yyyy, typeof yyyy);
      console.log("month", mm, typeof mm);
      console.log("date", dd, typeof dd);
      console.log("Palindrome value: ", isPalindrome, typeof isPalindrome);

      let [counter, preDate] = previousPalindromeDateCalc(
        yyyy,
        mm,
        dd,
        isPalindrome
      );

      outputMessage.style.display = "block";
      outputMessage.innerText =
        "Oh. You missed the palindrome by " +
        counter +
        " days." +
        " The previous palindrome was on " +
        preDate[0] +
        "-" +
        preDate[1] +
        "-" +
        preDate[2];
    }

    // if any results for dates is true then date is palindrome.
    // else calculate next palindrome date
  } else {
    outputMessage.innerText = "Hey, please input your birthday.";
  }
}

btnShow.addEventListener("click", calcPalindrome);
